# V3 -> V4: 从单会话执行到子代理隔离

## 版本差异（实测）

| 维度 | V3 | V4 |
|---|---|---|
| 代码行数 | 551 | 599 |
| 工具数 | 11 | 12 |
| 新增工具 | - | `subagent` |

---

## 核心改动

1. 新增 `subagent` 工具，用独立进程处理子任务。
2. 通过递归调用当前脚本实现上下文隔离。
3. 主流程扩展为 `plan -> delegate -> collect -> execute`。

---

## 设计价值

- 独立任务可隔离，减少主上下文污染。
- 失败可局部化，不拖垮主流程。
