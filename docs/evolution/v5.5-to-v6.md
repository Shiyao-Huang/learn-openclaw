# V5.5 -> V6: 从 Hook 基础设施到身份系统

## 版本差异（实测）

| 维度 | V5.5 | V6 |
|---|---|---|
| 代码行数 | 777 | 1041 |
| 工具数 | 12 | 14 |
| 关键新增 | Hook 机制 | IdentitySystem + 首次引导 |
| 新增工具 | - | `identity_update`, `bootstrap_complete` |

---

## 核心改动

### 1. 身份文件体系落地

V6 固定维护以下人格文件：

- `AGENTS.md`
- `SOUL.md`
- `IDENTITY.md`
- `USER.md`
- `BOOTSTRAP.md`
- `HEARTBEAT.md`
- `TOOLS.md`

并在启动时自动补齐缺失文件。

### 2. 首次引导闭环

- 若 `BOOTSTRAP.md` 存在且名字未设置 -> 进入 bootstrap 模式
- 完成后调用 `bootstrap_complete` 删除 `BOOTSTRAP.md`

### 3. 动态系统提示

从固定字符串升级为：

```text
BASE_SYSTEM + SOUL + USER + AGENTS (+ Hook 可修改内容)
```

---

## 接口变化（对模型）

新增：

```text
identity_update(file, content)
bootstrap_complete()
```

说明：`init/load/get` 由主流程调用或类内部使用，不是 V6 暴露工具。

---

## 设计意义

V6 让 Agent 的身份配置可持续演化：

- 可初始化
- 可更新
- 可持久化
- 可引导收敛

为 V7 的长期人格一致性和时间维记忆打下基础。

