# V15: å¤šæ¨¡å‹åä½œç³»ç»Ÿ

> ä¸åŒä»»åŠ¡ä½¿ç”¨ä¸åŒæ¨¡å‹ï¼Œä¼˜åŒ–æˆæœ¬å’Œèƒ½åŠ›åŒ¹é…

## æ ¸å¿ƒç†å¿µ

**"ç”¨å¯¹çš„æ¨¡å‹åšå¯¹çš„äº‹"**

- ç®€å•ä»»åŠ¡ï¼ˆç¿»è¯‘ã€æ ¼å¼åŒ–ï¼‰â†’ ä¾¿å®œå¿«é€Ÿçš„æ¨¡å‹
- å¤æ‚ä»»åŠ¡ï¼ˆæ¨ç†ã€ç¼–ç¨‹ï¼‰â†’ å¼ºå¤§çš„æ¨¡å‹
- ç‰¹æ®Šä»»åŠ¡ï¼ˆå›¾åƒã€è¯­éŸ³ï¼‰â†’ ä¸“ç”¨æ¨¡å‹

## è®¾è®¡ç›®æ ‡

1. **æ¨¡å‹æ³¨å†Œ** - ç»Ÿä¸€ç®¡ç†å¤šä¸ªæ¨¡å‹æä¾›å•†
2. **æ™ºèƒ½è·¯ç”±** - æ ¹æ®ä»»åŠ¡ç±»å‹è‡ªåŠ¨é€‰æ‹©æ¨¡å‹
3. **æˆæœ¬è¿½è¸ª** - è®°å½•æ¯ä¸ªæ¨¡å‹çš„ä½¿ç”¨æˆæœ¬
4. **é™çº§æœºåˆ¶** - ä¸»æ¨¡å‹å¤±è´¥æ—¶è‡ªåŠ¨åˆ‡æ¢å¤‡ç”¨
5. **èƒ½åŠ›å£°æ˜** - æ¯ä¸ªæ¨¡å‹å£°æ˜è‡ªå·±æ“…é•¿ä»€ä¹ˆ

## æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ModelRouter                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚           è·¯ç”±ç­–ç•¥ (Strategies)          â”‚    â”‚
â”‚  â”‚  - task_type: æŒ‰ä»»åŠ¡ç±»å‹è·¯ç”±             â”‚    â”‚
â”‚  â”‚  - cost_optimize: æˆæœ¬ä¼˜å…ˆ               â”‚    â”‚
â”‚  â”‚  - quality_first: è´¨é‡ä¼˜å…ˆ               â”‚    â”‚
â”‚  â”‚  - round_robin: è´Ÿè½½å‡è¡¡                 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                      â†“                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚           æ¨¡å‹æ³¨å†Œè¡¨ (Registry)          â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚ Claude  â”‚ â”‚  GPT-4  â”‚ â”‚ Gemini  â”‚    â”‚    â”‚
â”‚  â”‚  â”‚ Opus    â”‚ â”‚  Turbo  â”‚ â”‚  Pro    â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚ Claude  â”‚ â”‚ Llama   â”‚ â”‚ Mistral â”‚    â”‚    â”‚
â”‚  â”‚  â”‚ Haiku   â”‚ â”‚  70B    â”‚ â”‚  Large  â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                      â†“                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚           æˆæœ¬è¿½è¸ª (CostTracker)         â”‚    â”‚
â”‚  â”‚  - æŒ‰æ¨¡å‹ç»Ÿè®¡ token ä½¿ç”¨                 â”‚    â”‚
â”‚  â”‚  - è®¡ç®—å®é™…æˆæœ¬                          â”‚    â”‚
â”‚  â”‚  - ç”Ÿæˆä½¿ç”¨æŠ¥å‘Š                          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ•°æ®ç»“æ„

### ModelProvider

```typescript
interface ModelProvider {
  id: string;              // å”¯ä¸€æ ‡è¯†: "anthropic", "openai", "local"
  name: string;            // æ˜¾ç¤ºåç§°
  type: "api" | "local";   // API è°ƒç”¨ or æœ¬åœ°è¿è¡Œ
  baseUrl?: string;        // API ç«¯ç‚¹
  apiKey?: string;         // API å¯†é’¥ (ä»ç¯å¢ƒå˜é‡è¯»å–)
  models: ModelConfig[];   // è¯¥æä¾›å•†çš„æ¨¡å‹åˆ—è¡¨
}

interface ModelConfig {
  id: string;              // æ¨¡å‹ ID: "claude-sonnet-4-20250514"
  name: string;            // æ˜¾ç¤ºåç§°: "Claude Sonnet"
  provider: string;        // æä¾›å•† ID
  capabilities: string[];  // èƒ½åŠ›æ ‡ç­¾: ["reasoning", "coding", "vision"]
  costPer1kInput: number;  // è¾“å…¥æˆæœ¬ ($/1k tokens)
  costPer1kOutput: number; // è¾“å‡ºæˆæœ¬ ($/1k tokens)
  maxTokens: number;       // æœ€å¤§ä¸Šä¸‹æ–‡
  priority: number;        // ä¼˜å…ˆçº§ (è¶Šé«˜è¶Šä¼˜å…ˆ)
  enabled: boolean;        // æ˜¯å¦å¯ç”¨
}
```

### RoutingStrategy

```typescript
interface RoutingStrategy {
  name: string;
  description: string;
  route(task: TaskContext, models: ModelConfig[]): ModelConfig;
}

interface TaskContext {
  type: "chat" | "code" | "translate" | "summarize" | "vision" | "reasoning";
  complexity: "simple" | "medium" | "complex";
  inputTokens: number;
  priority: "low" | "normal" | "high";
}
```

### UsageRecord

```typescript
interface UsageRecord {
  timestamp: number;
  modelId: string;
  inputTokens: number;
  outputTokens: number;
  cost: number;
  taskType: string;
  latencyMs: number;
  success: boolean;
}
```

## æ–°å¢å·¥å…·

### 1. model_list
åˆ—å‡ºæ‰€æœ‰å·²æ³¨å†Œæ¨¡å‹

```typescript
{
  name: "model_list",
  description: "åˆ—å‡ºæ‰€æœ‰å·²æ³¨å†Œçš„æ¨¡å‹åŠå…¶çŠ¶æ€",
  input_schema: {
    type: "object",
    properties: {
      provider: { type: "string", description: "æŒ‰æä¾›å•†è¿‡æ»¤" },
      capability: { type: "string", description: "æŒ‰èƒ½åŠ›è¿‡æ»¤" }
    }
  }
}
```

### 2. model_register
æ³¨å†Œæ–°æ¨¡å‹

```typescript
{
  name: "model_register",
  description: "æ³¨å†Œæ–°çš„æ¨¡å‹é…ç½®",
  input_schema: {
    type: "object",
    properties: {
      provider: { type: "string", description: "æä¾›å•† ID" },
      model_id: { type: "string", description: "æ¨¡å‹ ID" },
      name: { type: "string", description: "æ˜¾ç¤ºåç§°" },
      capabilities: { type: "array", items: { type: "string" } },
      cost_input: { type: "number", description: "è¾“å…¥æˆæœ¬ $/1k" },
      cost_output: { type: "number", description: "è¾“å‡ºæˆæœ¬ $/1k" }
    },
    required: ["provider", "model_id", "name"]
  }
}
```

### 3. model_route
æ‰‹åŠ¨è·¯ç”±åˆ°æŒ‡å®šæ¨¡å‹æ‰§è¡Œä»»åŠ¡

```typescript
{
  name: "model_route",
  description: "å°†ä»»åŠ¡è·¯ç”±åˆ°æŒ‡å®šæ¨¡å‹æ‰§è¡Œ",
  input_schema: {
    type: "object",
    properties: {
      model_id: { type: "string", description: "ç›®æ ‡æ¨¡å‹ ID" },
      prompt: { type: "string", description: "è¦æ‰§è¡Œçš„æç¤º" },
      system: { type: "string", description: "ç³»ç»Ÿæç¤º (å¯é€‰)" }
    },
    required: ["model_id", "prompt"]
  }
}
```

### 4. model_cost
æŸ¥çœ‹æˆæœ¬ç»Ÿè®¡

```typescript
{
  name: "model_cost",
  description: "æŸ¥çœ‹æ¨¡å‹ä½¿ç”¨æˆæœ¬ç»Ÿè®¡",
  input_schema: {
    type: "object",
    properties: {
      days: { type: "number", description: "ç»Ÿè®¡å¤©æ•°", default: 7 },
      group_by: { type: "string", enum: ["model", "day", "task"], default: "model" }
    }
  }
}
```

### 5. model_config
é…ç½®è·¯ç”±ç­–ç•¥

```typescript
{
  name: "model_config",
  description: "é…ç½®æ¨¡å‹è·¯ç”±ç­–ç•¥",
  input_schema: {
    type: "object",
    properties: {
      strategy: { type: "string", enum: ["task_type", "cost_optimize", "quality_first", "round_robin"] },
      default_model: { type: "string", description: "é»˜è®¤æ¨¡å‹ ID" },
      fallback_model: { type: "string", description: "é™çº§æ¨¡å‹ ID" }
    }
  }
}
```

## è·¯ç”±ç­–ç•¥è¯¦è§£

### 1. task_type (æŒ‰ä»»åŠ¡ç±»å‹)

```typescript
const taskModelMapping = {
  "reasoning": ["claude-opus-4-6", "gpt-4-turbo"],
  "coding": ["claude-sonnet-4-20250514", "gpt-4-turbo"],
  "translate": ["claude-haiku", "gpt-3.5-turbo"],
  "summarize": ["claude-haiku", "gemini-pro"],
  "vision": ["claude-sonnet-4-20250514", "gpt-4-vision"],
  "chat": ["claude-sonnet-4-20250514", "gpt-4-turbo"]
};
```

### 2. cost_optimize (æˆæœ¬ä¼˜å…ˆ)

ä¼˜å…ˆé€‰æ‹©æˆæœ¬æœ€ä½çš„èƒ½æ»¡è¶³éœ€æ±‚çš„æ¨¡å‹ï¼š
1. è¿‡æ»¤å‡ºå…·å¤‡æ‰€éœ€èƒ½åŠ›çš„æ¨¡å‹
2. æŒ‰æˆæœ¬æ’åº
3. é€‰æ‹©æœ€ä¾¿å®œçš„

### 3. quality_first (è´¨é‡ä¼˜å…ˆ)

ä¼˜å…ˆé€‰æ‹©èƒ½åŠ›æœ€å¼ºçš„æ¨¡å‹ï¼š
1. æŒ‰ä¼˜å…ˆçº§æ’åº
2. é€‰æ‹©ä¼˜å…ˆçº§æœ€é«˜çš„å¯ç”¨æ¨¡å‹

### 4. round_robin (è´Ÿè½½å‡è¡¡)

åœ¨åŒç­‰èƒ½åŠ›çš„æ¨¡å‹é—´è½®è¯¢ï¼Œé¿å…å•ä¸€æ¨¡å‹è¿‡è½½ã€‚

## é™çº§æœºåˆ¶

```typescript
async function executeWithFallback(
  task: TaskContext,
  models: ModelConfig[]
): Promise<Response> {
  const sortedModels = models.sort((a, b) => b.priority - a.priority);
  
  for (const model of sortedModels) {
    try {
      return await callModel(model, task);
    } catch (error) {
      console.log(`æ¨¡å‹ ${model.id} å¤±è´¥ï¼Œå°è¯•ä¸‹ä¸€ä¸ª...`);
      continue;
    }
  }
  
  throw new Error("æ‰€æœ‰æ¨¡å‹éƒ½å¤±è´¥äº†");
}
```

## æŒä¹…åŒ–

```
.models/
â”œâ”€â”€ registry.json      # æ¨¡å‹æ³¨å†Œè¡¨
â”œâ”€â”€ config.json        # è·¯ç”±é…ç½®
â””â”€â”€ usage/
    â””â”€â”€ 2026-02-10.jsonl  # æ¯æ—¥ä½¿ç”¨è®°å½•
```

## ä½¿ç”¨ç¤ºä¾‹

### æ³¨å†Œ OpenAI æ¨¡å‹

```
> æ³¨å†Œ GPT-4 æ¨¡å‹

model_register({
  provider: "openai",
  model_id: "gpt-4-turbo",
  name: "GPT-4 Turbo",
  capabilities: ["reasoning", "coding", "chat"],
  cost_input: 0.01,
  cost_output: 0.03
})
```

### æŸ¥çœ‹æˆæœ¬æŠ¥å‘Š

```
> çœ‹çœ‹è¿™å‘¨èŠ±äº†å¤šå°‘é’±

model_cost({ days: 7, group_by: "model" })

ğŸ“Š æ¨¡å‹ä½¿ç”¨æˆæœ¬ (æœ€è¿‘ 7 å¤©)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
æ¨¡å‹                 è°ƒç”¨æ¬¡æ•°    æˆæœ¬
claude-opus-4-6         45      $2.34
claude-sonnet-4-20250514        123     $0.89
gpt-4-turbo             12      $0.45
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
æ€»è®¡                    180     $3.68
```

### è·¯ç”±åˆ°ç‰¹å®šæ¨¡å‹

```
> ç”¨ GPT-4 ç¿»è¯‘è¿™æ®µè¯

model_route({
  model_id: "gpt-4-turbo",
  prompt: "Translate to Chinese: Hello world"
})
```

## ä¸ç°æœ‰ç³»ç»Ÿé›†æˆ

### ä¸ V4 å­ä»£ç†åè°ƒ

å­ä»£ç†å¯ä»¥ä½¿ç”¨ä¸åŒæ¨¡å‹ï¼š
- ä¸»ä»£ç†: Claude Opus (å¤æ‚æ¨ç†)
- ç ”ç©¶å­ä»£ç†: Claude Sonnet (ä¿¡æ¯æ”¶é›†)
- ç¿»è¯‘å­ä»£ç†: Claude Haiku (å¿«é€Ÿç¿»è¯‘)

### ä¸ V12 å®‰å…¨ç³»ç»Ÿ

- æ¨¡å‹è°ƒç”¨è®°å½•çº³å…¥å®¡è®¡æ—¥å¿—
- API å¯†é’¥é€šè¿‡å®‰å…¨ç³»ç»Ÿç®¡ç†
- æ•æ„Ÿæ•°æ®åœ¨è·¨æ¨¡å‹ä¼ è¾“æ—¶è‡ªåŠ¨è„±æ•

### ä¸ V13 è‡ªè¿›åŒ–ç³»ç»Ÿ

- åˆ†æå“ªäº›ä»»åŠ¡ç”¨å“ªä¸ªæ¨¡å‹æ•ˆæœæœ€å¥½
- è‡ªåŠ¨ä¼˜åŒ–è·¯ç”±ç­–ç•¥
- å»ºè®®æˆæœ¬ä¼˜åŒ–æ–¹æ¡ˆ

## ä»£ç ç»Ÿè®¡é¢„ä¼°

- ModelRouter ç±»: ~300 è¡Œ
- è·¯ç”±ç­–ç•¥: ~150 è¡Œ
- æˆæœ¬è¿½è¸ª: ~100 è¡Œ
- å·¥å…·å®šä¹‰: ~100 è¡Œ
- æ€»è®¡: ~650 è¡Œ

## ä¸‹ä¸€æ­¥

V16: å·¥ä½œæµå¼•æ“ - å¤æ‚ä»»åŠ¡çš„è‡ªåŠ¨åŒ–ç¼–æ’
