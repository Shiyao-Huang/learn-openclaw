# V24: 语音能力 (Audio/Voice Capabilities)

## 概述

V24 为 OpenClaw 添加了语音能力，让 Agent 能够将文字转换为语音并进行播放控制。这是迈向多模态交互的重要一步。

## 功能特性

### 文字转语音 (TTS)

- **多引擎支持**: Edge TTS (免费)、macOS Say (本地)
- **多语言语音**: 中文、英文、日语
- **语速控制**: 支持 0.5x - 2.0x 语速调整
- **音频缓存**: 自动缓存常用文本，避免重复合成
- **历史记录**: 追踪所有 TTS 请求

### 音频播放

- **跨平台**: 支持 macOS (afplay)、Linux (paplay/aplay)、Windows
- **音量控制**: 系统音量调节 (macOS)
- **播放控制**: 播放音频文件

## 工具列表

| 工具名 | 描述 |
|--------|------|
| `tts_synthesize` | 将文字转换为语音 |
| `tts_list_voices` | 获取所有可用语音 |
| `tts_history` | 查看 TTS 历史记录 |
| `tts_delete` | 删除音频文件 |
| `audio_play` | 播放音频文件 |
| `audio_volume` | 获取/设置系统音量 |

## 使用示例

### 基础 TTS

```typescript
// 使用默认语音 (中文女声 - 晓晓)
await handlers.tts_synthesize({
  text: "你好，我是 OpenClaw 语音助手。"
});

// 使用指定语音
await handlers.tts_synthesize({
  text: "Hello, this is a test.",
  voice: "en-US-AriaNeural",
  speed: 1.2
});
```

### 播放音频

```typescript
// 播放生成的音频
await handlers.audio_play({
  audio_path: "/path/to/audio.mp3",
  volume: 80
});
```

### 列出可用语音

```typescript
await handlers.tts_list_voices({});
// 返回:
// - zh-CN-XiaoxiaoNeural: 晓晓 (zh-CN, 女)
// - zh-CN-YunxiNeural: 云希 (zh-CN, 男)
// - en-US-AriaNeural: Aria (en-US, 女)
```

## 可用语音

### 中文

| ID | 名称 | 性别 |
|----|------|------|
| zh-CN-XiaoxiaoNeural | 晓晓 | 女 |
| zh-CN-YunxiNeural | 云希 | 男 |
| zh-CN-YunjianNeural | 云健 | 男 |

### 英文

| ID | 名称 | 性别 |
|----|------|------|
| en-US-AriaNeural | Aria | 女 |
| en-US-GuyNeural | Guy | 男 |

### 日文

| ID | 名称 | 性别 |
|----|------|------|
| ja-JP-NanamiNeural | 七海 | 女 |

## 依赖安装

### Edge TTS (推荐)

```bash
# 需要 Python 和 pip
pip install edge-tts
```

### FFmpeg (可选)

用于获取音频文件时长信息:

```bash
# macOS
brew install ffmpeg

# Ubuntu/Debian
sudo apt-get install ffmpeg

# Windows
# 下载: https://ffmpeg.org/download.html
```

## 架构

```
v24-agent/audio/
├── index.ts      # 模块入口
├── types.ts      # 类型定义
├── tts.ts        # TTS 引擎
├── player.ts     # 音频播放器
├── tools.ts      # 工具定义
└── handlers.ts   # 工具处理器
```

### 核心组件

1. **TTSEngine**: 文字转语音核心引擎
   - 支持多种 TTS 提供商
   - 缓存管理
   - 历史记录

2. **AudioPlayer**: 跨平台音频播放
   - 自动检测平台
   - 音量控制
   - 播放状态管理

## 配置

```typescript
const config = createDefaultConfig("/path/to/output");
// {
//   defaultProvider: "edge",
//   defaultVoice: "zh-CN-XiaoxiaoNeural",
//   defaultSpeed: 1.0,
//   outputDir: "/path/to/output",
//   maxTextLength: 5000,
//   supportedFormats: [...],
//   enableCache: true
// }
```

## 使用场景

1. **朗读长文本**: 将文章、报告转换为语音
2. **语音提醒**: 定时任务语音提示
3. **辅助阅读**: 帮助视障用户获取信息
4. **多语言发音**: 学习外语发音
5. **内容创作**: 生成配音音频

## 限制

- 最大文本长度: 5000 字符 (可配置)
- Edge TTS 需要网络连接
- 音频播放依赖系统播放器
- 音量控制仅支持 macOS

## 未来扩展

- [ ] 语音识别 (STT): 语音转文字
- [ ] 更多 TTS 引擎: ElevenLabs、OpenAI TTS
- [ ] 实时语音流
- [ ] 音频编辑功能
