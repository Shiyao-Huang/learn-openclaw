# V28: 链接理解系统

> 让 Agent 能够自动提取、获取和理解链接内容

---

## 概述

V28 基于 OpenClaw 的 `link-understanding` 模块，为 Agent 添加了智能链接处理能力。Agent 可以从用户消息中自动提取链接，获取链接内容，并进行智能缓存。

## 核心能力

### 1. 链接提取 (`link_extract`)

从消息中自动识别和提取 HTTP/HTTPS 链接：

```typescript
// 支持的格式
"Check https://example.com"              // 纯 URL
"See [Example](https://example.com)"     // Markdown 链接
"Visit <https://example.com>"            // 尖括号链接
```

**特性:**
- 自动过滤私有 IP (192.168.x.x, 10.x.x.x, etc.)
- 自动过滤 localhost
- 可配置最大提取数量
- 支持 HTTP 和 HTTPS

### 2. 内容获取 (`link_fetch`)

获取单个链接的内容：

```typescript
const result = await engine.fetchLink("https://example.com", {
  timeoutSeconds: 30,
  format: "text", // 或 "markdown"
});
```

**返回内容:**
- `content`: 提取的文本内容
- `format`: 内容格式
- `metadata`: 元数据 (标题、描述、类型等)
- `error`: 错误信息 (如有)

### 3. 批量获取 (`link_batch_fetch`)

同时获取多个链接的内容：

```typescript
const result = await engine.fetchLinks(urls, {
  timeoutSeconds: 30,
  concurrency: 3,
  useCache: true,
});
```

**返回:**
- `successful`: 成功获取的链接列表
- `failed`: 失败的链接列表
- `durationMs`: 总处理时间

### 4. 安全验证 (`link_validate`)

验证 URL 是否安全可访问：

```typescript
const result = validateUrl("https://example.com");
// { valid: true } 或 { valid: false, reason: "..." }
```

**安全检查:**
- 拒绝 localhost
- 拒绝私有 IP
- 拒绝无效 URL

### 5. 智能缓存

自动缓存已获取的内容：
- 默认缓存 TTL: 1 小时
- 最大缓存数量: 100 条
- 支持 URL 级别和全局清除

## 工具列表

| 工具 | 描述 |
|------|------|
| `link_extract` | 从消息中提取链接 |
| `link_fetch` | 获取单个链接内容 |
| `link_batch_fetch` | 批量获取链接内容 |
| `link_status` | 获取系统状态 |
| `link_clear_cache` | 清除缓存 |
| `link_validate` | 验证 URL 安全性 |

## 代码结构

```
v28-agent/
├── link/
│   ├── types.ts      # 类型定义
│   ├── engine.ts     # 引擎核心
│   ├── detect.ts     # 链接检测
│   ├── fetcher.ts    # 内容获取
│   ├── cache.ts      # 缓存管理
│   ├── tools.ts      # 工具定义
│   ├── handlers.ts   # 工具处理器
│   ├── defaults.ts   # 默认配置
│   └── index.ts      # 模块入口
└── v28-agent.ts      # 主入口
```

## 配置选项

```typescript
interface LinkEngineConfig {
  enabled?: boolean;       // 是否启用 (默认: true)
  maxLinks?: number;       // 最大链接数 (默认: 5)
  timeoutSeconds?: number; // 超时时间 (默认: 30)
  providers?: LinkProviderConfig[]; // 提供者列表
  storageDir?: string;     // 存储目录
}
```

## 使用场景

1. **自动链接分析**: 用户发送消息时自动提取链接
2. **内容摘要**: 获取网页内容进行摘要
3. **链接预览**: 生成链接预览信息
4. **安全过滤**: 防止访问危险 URL
5. **批量处理**: 一次处理多个链接

## 安全特性

- **私有 IP 过滤**: 防止 SSRF 攻击
- **Localhost 过滤**: 防止本地服务访问
- **超时控制**: 防止长时间等待
- **内容大小限制**: 防止内存溢出

## 继承关系

V28 继承 V27 的所有能力：

- ✅ 向量嵌入 (Embedding)
- ✅ Canvas 显示系统
- ✅ 语音识别 (STT)
- ✅ 语音能力 (TTS)
- ✅ 图像理解 (Vision)
- ✅ 代码执行沙箱
- ✅ 定时任务
- ✅ 浏览器自动化
- ... 以及更早版本的所有能力

## 工具统计

- **V27 工具数**: 153
- **V28 新增**: 6
- **V28 总计**: 159

---

*Created: 2026-02-14*
